# デジタル署名（Digital Signatures）

## 概要
秘密鍵で署名し、公開鍵で検証。完全性と否認防止を提供。

## 代表的なアルゴリズム
- RSA-PSS
- ECDSA
- Ed25519（EdDSA）

## 分散署名（Distributed Signatures）

### 分散署名の概要
分散署名は、単一の秘密鍵を複数の参加者間で分散し、全員の協力なしでは署名ができないようにする技術です。

**主な目的：**
- 単一障害点の排除
- 内部者攻撃への耐性
- 鍵の可用性向上
- 責任の分散

**基本概念：**
- **閾値秘密分散（Threshold Secret Sharing）**: k個の分散鍵からt個以上が揃えば秘密鍵を復元可能
- **分散署名プロトコル**: 分散鍵を持つ参加者たちが協力して署名を生成
- **検証**: 通常の公開鍵で署名を検証可能

### RSA署名をベースとした分散署名

#### 基本的な分散RSA署名
**前提条件：**
- 公開鍵: (N, e)
- 秘密鍵: d
- 分散鍵: d₁, d₂, ..., dₙ

**分散鍵生成（Shamir's Secret Sharing ベース）:**
```
1. 素数 p, q を選択し、N = p × q を計算
2. φ(N) = (p-1)(q-1) を計算
3. e を選択し、d × e ≡ 1 (mod φ(N)) を満たす d を計算
4. 多項式 f(x) = d + a₁x + a₂x² + ... + aₜ₋₁xᵗ⁻¹ (mod φ(N)) を生成
5. 分散鍵: dᵢ = f(i) (i = 1, 2, ..., n)
```

**分散署名生成:**
```
1. 各参加者 i が部分署名 sᵢ = m^dᵢ (mod N) を計算
2. 部分署名を組み合わせて完全署名を生成
3. 署名検証: s^e ≡ m (mod N)
```

#### 安全性：分散鍵から秘密鍵の復元

**情報理論的安全性:**
- t-1個以下の分散鍵からは秘密鍵に関する情報が得られない
- Shamir's Secret Sharing の性質により保証

**計算量的安全性:**
- RSA問題の困難性に基づく
- 分散鍵から秘密鍵を復元するには、RSA問題を解く必要

**攻撃モデル:**
- **受動的攻撃者**: 分散鍵を盗聴するが、署名プロトコルに干渉しない
- **能動的攻撃者**: 署名プロトコルに参加し、不正な値を送信

### 拡張された分散RSA署名

#### 分散鍵の生成方法

**1. 信頼できる分散者（Trusted Dealer）方式**
```
- 単一の信頼できる分散者が分散鍵を生成・配布
- 分散者の完全性に依存
- 実装が簡単だが、分散者が単一障害点となる
```

**2. 分散鍵生成（Distributed Key Generation, DKG）**
```
- 参加者全員が協力して分散鍵を生成
- 信頼できる分散者を不要とする
- より高いセキュリティを提供
```

**DKGプロトコルの基本手順:**
```
1. 各参加者が秘密値 sᵢ を選択
2. 各参加者が Shamir's Secret Sharing で sᵢ を分散
3. 全参加者に分散鍵を配布
4. 最終的な分散鍵を計算（各参加者の分散鍵の線形結合）
```

#### 受動的・能動的攻撃者に対する安全性

**受動的攻撃者に対する安全性:**
- **情報理論的安全性**: t-1個以下の分散鍵から秘密鍵に関する情報が漏洩しない
- **計算量的安全性**: RSA問題の困難性に基づく

**能動的攻撃者に対する安全性:**
- **検証可能秘密分散（Verifiable Secret Sharing, VSS）**: 分散鍵の正しさを検証可能
- **コミットメント方式**: 参加者の不正を検出可能
- **ゼロ知識証明**: 分散鍵の知識を証明

**攻撃者モデル:**
```
- Honest-but-curious: プロトコルに従うが、情報を収集
- Malicious: 任意の不正行為を行う
- Adaptive: 攻撃中に他の参加者を選択的に攻撃
```

#### (t, k)-閾値秘密分散

**定義:**
- n個の参加者中、k個の分散鍵からt個以上が揃えば秘密鍵を復元可能
- t ≤ k ≤ n の関係

**Shamir's Secret Sharing の拡張:**
```
- 多項式の次数を t-1 に設定
- k個の点から多項式を補間
- 任意の t 個の分散鍵で秘密鍵を復元
```

**実装例:**
```
1. 多項式 f(x) = s + a₁x + a₂x² + ... + aₜ₋₁xᵗ⁻¹ (mod p)
2. 分散鍵: (i, f(i)) for i = 1, 2, ..., n
3. Lagrange補間で秘密鍵 s を復元
```

#### Proactive 方式

**概要:**
- 分散鍵を定期的に更新
- 長期にわたる攻撃に対する耐性を向上
- 鍵の新鮮性を保証

**更新プロトコル:**
```
1. 各参加者が新しい多項式を生成
2. 既存の分散鍵に新しい多項式の分散鍵を加算
3. 更新後の分散鍵を計算
4. 古い分散鍵を安全に削除
```

**セキュリティ利点:**
- **前向き安全性**: 過去の分散鍵が漏洩しても将来の署名は安全
- **適応的攻撃への耐性**: 攻撃者が分散鍵を取得しても、更新により無効化
- **長期運用**: システムの長期運用が可能

**実装上の考慮事項:**
```
- 更新頻度の決定
- 更新中の可用性確保
- 更新失敗時の復旧手順
- 参加者の動的な参加・離脱
```

## サンプルコード
- Ed25519 署名/検証: `src/signature/ed25519.ts`

## セキュリティ上の注意
- 適切な鍵サイズ・曲線の選択
- 署名対象データの正規化
- 分散署名では参加者の認証・認可
- 分散鍵の安全な保管・伝送
- 定期的な分散鍵の更新

## 参考資料
- RFC 8032 (Ed25519)
- FIPS 186-5
- Shamir, A. (1979). "How to share a secret"
- Gennaro, R., et al. (1996). "Secure distributed key generation for discrete-log based cryptosystems"
- Herzberg, A., et al. (1995). "Proactive secret sharing" 